<?xml version="1.0" encoding="ISO-8859-1" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/root.xhtml">

	<ui:define name="title">FASTA</ui:define>

	<ui:define name="page">
		<div id="global">
			<div class="fasta">
				<h:form id="form">
					<p:growl id="growl" showDetail="true" />

					<div class="menu">
						<ui:include src="menu.xhtml" />
					</div>

					<div class="contentBackground">
						<ui:insert name="contenu" />
					</div>
					<div class="contentBackgroundNone">
						<ui:insert name="piedPage" />
					</div>

				</h:form>

				<p:socket transport="long-polling" widgetVar="subsciber"
					onMessage="handleMessage" channel="/asta" autoConnect="true" />

				<script type="text/javascript">

                	function handleMessage(message) {
                		console.log(message);
                		var chatContent;
                		switch (message.type) {
                	    case "bid":
                	    	chatContent = $(PrimeFaces.escapeClientId('form:public')), text = message.value;
                            chatContent.append(' '+text+' ' + '<br />');
                	        break;
                	    case "information":
                	    	 chatContent = $(PrimeFaces.escapeClientId('form:public')), text = message.text;
                	    	 chatContent.append(text + '<br />');
                	        break;
                    	default:
                	        console.log("Channel not defined");
                	    }
                        //keep scroll
                        chatContent.scrollTop(chatContent.height());
                        if (message.updateList) {
                            updateList();
                        }
                    }
                </script>

			</div>
		</div>
	</ui:define>
</ui:composition>